# Story 1.20: Methodology Explanation Page

## Status
Draft

## Story

**As a** frontend developer,
**I want** to create an educational methodology explanation page,
**so that** users understand the evidence tier system, weighted scoring, and regulatory alignment.

## Acceptance Criteria

1. **Component: MethodologyExplanation.tsx** - Standalone page
   - Route: `/methodology` (public, accessible without login)
   - Also accessible via "How is this calculated?" button in assessment results
2. **Section: Introduction**
   - Heading: "Understanding Your Risk Score"
   - 2-3 paragraphs explaining the enhanced methodology's purpose
   - Key differentiators: evidence-weighted, regulatory-aligned, transparent
3. **Section: Evidence Tier System**
   - Visual diagram showing 3 tiers with examples:
     - Tier 2 (×1.0): System logs, API responses, database exports
     - Tier 1 (×0.8): Policy documents, procedures, approved workflows
     - Tier 0 (×0.6): Self-declared statements, emails, informal docs
   - "Why this matters" explanation: distinguishes proof vs promises
4. **Section: Two-Level Weighted Scoring**
   - Visual diagram showing:
     - Question weights within sections (foundational questions highlighted)
     - Section weights in overall score (size proportional to weight)
   - Example calculation with sample data:
     - Section: Sanctions Compliance (18% weight)
     - Q1 (20% weight): Score 3.0 × 0.8 (Tier 1) = 2.4 → Contribution: 0.48
     - ... (show 3-4 questions)
     - Section score: 3.04/5 → Overall contribution: 3.04 × 18% = 0.547
   - Interactive calculator: user can input sample scores and see calculation
5. **Section: Regulatory Framework Alignment**
   - References to FFIEC BSA/AML, FATF 40 Recommendations
   - Explanation of how section weights derived from enforcement priorities
   - "This methodology aligns with regulatory expectations" statement
6. **Section: FAQ**
   - Q: "Why don't my old assessments have risk scores?"
     - A: Risk scoring was implemented on [date]. Assessments completed before this date don't have scores. Re-run your assessment to receive a risk score.
   - Q: "How can I improve my score?"
     - A: Upload Tier 2 evidence (system-generated data), address high-priority gaps first
   - Q: "Can I customize the weights?"
     - A: Admin users can adjust weights, but defaults are framework-aligned (not recommended for most users)
   - 5-7 common questions with clear answers
7. **Section: Worked Example**
   - Full end-to-end example with fictional company
   - Shows: documents uploaded → tiers assigned → questions scored → sections weighted → overall score calculated
   - Step-by-step breakdown with visual aids
8. Footer: "Questions? Contact support" with link
9. Responsive design: readable on all devices
10. Printable: clean print stylesheet for PDF export

## Tasks / Subtasks

- [ ] Create main MethodologyExplanation component (AC: 1)
  - [ ] Create `/frontend/src/pages/MethodologyExplanation.tsx`
  - [ ] Add route `/methodology` to router (public route, no auth required)
  - [ ] Create page layout with navigation (back to assessment if from results)
  - [ ] Add table of contents with anchor links to sections
  - [ ] Implement scroll-to-section on anchor click
- [ ] Create Introduction section (AC: 2)
  - [ ] Add "Understanding Your Risk Score" heading
  - [ ] Write 2-3 paragraph introduction explaining:
    - Purpose: provide defensible, auditor-ready risk assessment
    - Evidence-weighted: not all documentation is equal
    - Regulatory-aligned: weights based on enforcement priorities
    - Transparent: full scoring breakdown available
  - [ ] Add visual callout box highlighting key differentiators
- [ ] Create Evidence Tier System section (AC: 3)
  - [ ] Create `/frontend/src/components/methodology/EvidenceTierDiagram.tsx`
  - [ ] Design 3-tier visual diagram:
    - Use vertical cards or horizontal timeline
    - Show tier icons (Database, FileCheck, FileText from Lucide)
    - Display multipliers (×1.0, ×0.8, ×0.6)
    - List example document types per tier
  - [ ] Add "Why this matters" explanation box
  - [ ] Explain: "Tier 2 provides verifiable proof, Tier 0 is self-reported (may be aspirational)"
  - [ ] Use color coding matching EvidenceTierBadge (gold, silver, bronze)
- [ ] Create Two-Level Weighted Scoring section (AC: 4)
  - [ ] Create `/frontend/src/components/methodology/WeightedScoringDiagram.tsx`
  - [ ] Design visual showing:
    - Section weight bars (proportional to weight percentage)
    - Question weights within section (nested bars or tree structure)
    - Foundational questions highlighted with star icon
  - [ ] Add example calculation with sample data:
    - Use realistic section: "Sanctions Compliance (18% weight)"
    - Show 3-4 questions with weights, scores, tiers, multipliers
    - Calculate question contributions
    - Calculate section score
    - Calculate weighted contribution to overall score
  - [ ] Create interactive calculator component:
    - Input fields: question score (0-5), evidence tier (0/1/2), question weight (%)
    - Calculate and display: final score, section contribution
    - Use Radix Slider for score inputs
  - [ ] Add explanation text for each step of calculation
- [ ] Create Regulatory Framework Alignment section (AC: 5)
  - [ ] Add heading: "Built on Regulatory Standards"
  - [ ] Write content explaining:
    - FFIEC BSA/AML framework: sections weighted by pillar importance
    - FATF 40 Recommendations: risk area prioritization
    - Enforcement data: weights reflect actual regulatory focus
  - [ ] Add reference links to FFIEC and FATF resources
  - [ ] Include statement: "This methodology aligns with regulatory expectations and is suitable for auditor presentation"
  - [ ] Add visual badge: "Regulatory-Aligned Methodology"
- [ ] Create FAQ section (AC: 6)
  - [ ] Create `/frontend/src/components/methodology/FAQAccordion.tsx`
  - [ ] Use Radix Accordion for expandable Q&A
  - [ ] Add 7 common questions:
    1. Why don't my old assessments have risk scores?
    2. How can I improve my score?
    3. Can I customize the weights?
    4. What's the difference between raw score and final score?
    5. Why are some questions marked as "foundational"?
    6. How often should I update my assessment?
    7. Can I export my methodology explanation?
  - [ ] Write clear, concise answers (2-3 sentences each)
  - [ ] Add icons to each question (Lucide icons)
  - [ ] Link relevant FAQs to other sections (e.g., "improve score" links to evidence tier section)
- [ ] Create Worked Example section (AC: 7)
  - [ ] Create `/frontend/src/components/methodology/WorkedExample.tsx`
  - [ ] Create fictional company scenario: "FinTech Startup, Series B, 50 employees"
  - [ ] Show step-by-step process:
    - Step 1: Upload documents (3 examples with file types)
    - Step 2: Evidence classification (show tier assignments with reasoning)
    - Step 3: Question scoring (show 3 questions with AI scores)
    - Step 4: Tier multipliers applied (show calculations)
    - Step 5: Section weighting (show section score calculation)
    - Step 6: Overall score (show final risk score with band)
  - [ ] Add visual progress through steps (stepper component)
  - [ ] Use realistic data that matches actual scoring logic
  - [ ] Include visual aids: document icons, calculation tables, progress bars
- [ ] Add footer and navigation (AC: 8)
  - [ ] Add footer section with "Questions? Contact support"
  - [ ] Add support email link or contact form link
  - [ ] Add "Back to Assessment" button if accessed from results (check referrer)
  - [ ] Add "Print This Page" button
  - [ ] Add social share buttons (optional)
- [ ] Implement responsive design (AC: 9)
  - [ ] Mobile (<768px): single column, simplified diagrams
  - [ ] Tablet (768-1023px): two-column where appropriate
  - [ ] Desktop (≥1024px): full layout with sidebar TOC
  - [ ] Test all diagrams and calculators on mobile
  - [ ] Ensure interactive calculator works on touch devices
- [ ] Add print stylesheet (AC: 10)
  - [ ] Create print-specific CSS: `@media print { ... }`
  - [ ] Hide navigation, TOC, interactive elements
  - [ ] Expand all accordion items for print
  - [ ] Add page breaks before major sections
  - [ ] Ensure diagrams print correctly (use CSS, not canvas)
  - [ ] Add header/footer with page numbers and URL

## Dev Notes

### Relevant Source Tree
- `/frontend/src/pages/` - Page components
- `/frontend/src/components/methodology/` - NEW subdirectory for methodology components
- `/frontend/src/components/ui/` - Radix UI component library
- `/frontend/src/pages/AssessmentResults.tsx` - Links to methodology page

### Design Decisions

**Public Access:**
Methodology page is publicly accessible (no authentication required) so potential customers can understand the methodology before signing up. This builds trust and transparency.

**Educational Tone:**
Write in clear, jargon-free language. Assume audience includes non-technical users (compliance officers, executives) and technical users (IT, risk managers).

**Visual Learning:**
Heavy use of diagrams, examples, and interactive elements. Visual learners need to see the calculation in action, not just read about it.

**Interactive Calculator:**
Allow users to experiment with sample scores to understand how tier multipliers and weights affect final scores. This builds intuition about how to improve their own assessments.

**Print-Friendly:**
Many users will want to print this page for offline reference or to share with auditors. Ensure clean print layout without interactive elements.

### Content Structure

```typescript
interface MethodologyContent {
  introduction: {
    heading: string;
    paragraphs: string[];
    keyPoints: string[];
  };
  evidenceTiers: {
    tiers: Array<{
      tier: 0 | 1 | 2;
      multiplier: number;
      name: string;
      examples: string[];
      icon: string;
      color: string;
    }>;
    explanation: string;
  };
  weightedScoring: {
    diagram: WeightedScoringDiagramData;
    exampleCalculation: CalculationExample;
    interactiveCalculator: boolean;
  };
  regulatoryAlignment: {
    frameworks: Array<{ name: string; url: string; description: string }>;
    statement: string;
  };
  faq: Array<{
    question: string;
    answer: string;
    icon: string;
    relatedSection?: string;
  }>;
  workedExample: {
    scenario: string;
    steps: Array<{
      title: string;
      description: string;
      visualData: any;
    }>;
  };
}
```

### Integration Points

**Navigation from Assessment Results:**
When user clicks "How is this calculated?" in assessment results, pass assessment context to methodology page. Highlight relevant sections based on what user wants to understand.

**Link Pattern:**
```typescript
// From assessment results
<Link to="/methodology?highlight=weighted-scoring">
  How is this calculated?
</Link>

// Methodology page detects highlight param
const params = new URLSearchParams(location.search);
const highlight = params.get('highlight');
// Scroll to and highlight section on mount
```

**Radix UI Components to Use:**
- `Accordion` - FAQ section
- `Slider` - Interactive calculator inputs
- `Tabs` - Alternative organization for content (optional)
- `Card` - Content sections, example calculations
- `Badge` - Regulatory alignment badge, tier badges
- `Tooltip` - Explanations for technical terms
- `Button` - Print, back navigation

**Print Stylesheet Example:**
```css
@media print {
  /* Hide interactive elements */
  nav, .toc, button, .interactive-calculator {
    display: none;
  }

  /* Expand all accordions */
  .faq-accordion [data-state="closed"] {
    display: block !important;
  }

  /* Page breaks */
  .methodology-section {
    page-break-before: always;
  }

  /* Ensure colors print */
  * {
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
  }

  /* Add page footer */
  @page {
    @bottom-right {
      content: "Page " counter(page);
    }
  }
}
```

### Example Calculation Data

```typescript
const exampleCalculation = {
  section: {
    name: "Sanctions Compliance",
    weight: 0.18, // 18%
    questions: [
      {
        text: "Do you have automated sanctions screening?",
        weight: 0.25, // 25% within section
        rawScore: 4.0,
        evidenceTier: 'TIER_2',
        multiplier: 1.0,
        finalScore: 4.0,
        contribution: 1.0, // 4.0 × 0.25
      },
      {
        text: "Are sanctions policies documented?",
        weight: 0.20,
        rawScore: 3.0,
        evidenceTier: 'TIER_1',
        multiplier: 0.8,
        finalScore: 2.4,
        contribution: 0.48,
      },
      // ... more questions
    ],
  },
  sectionScore: 3.04, // average of question contributions
  overallContribution: 0.547, // 3.04 × 0.18
};
```

### Existing Patterns to Follow

**Public Page Pattern:**
No authentication wrapper, accessible to all users. Similar to landing page or login page structure.

**Documentation Style:**
Use clear headings, short paragraphs, bullet points for key takeaways. Add visual hierarchy with heading sizes.

**Link to Support:**
Use existing support contact method (email or contact form). Match footer style from other public pages.

### Testing

**Test File Location:**
- Component tests: `/frontend/src/components/__tests__/MethodologyExplanation.test.tsx`
- Component tests: `/frontend/src/components/__tests__/methodology/*.test.tsx`

**Testing Frameworks:**
- Vitest 3 + React Testing Library
- Test public route access (no auth required)
- Test interactive calculator logic
- Test print stylesheet (via jsdom or Puppeteer)

**Test Cases:**
1. Methodology page accessible without authentication
2. All sections render correctly
3. Introduction text displays with key points
4. Evidence tier diagram shows 3 tiers correctly
5. Tier examples display for each tier
6. Weighted scoring diagram renders
7. Example calculation displays with correct math
8. Interactive calculator accepts input and calculates correctly
9. Calculator validates input ranges (0-5 for scores)
10. Regulatory alignment section displays frameworks
11. FAQ accordion expands/collapses correctly
12. All 7 FAQ questions display
13. FAQ answers are clear and helpful
14. Worked example shows all 6 steps
15. Worked example calculations are accurate
16. Progress stepper navigates through example steps
17. Footer displays support contact
18. "Back to Assessment" button appears when from results
19. "Print This Page" button triggers print dialog
20. Responsive layout works on mobile/tablet/desktop
21. Print stylesheet hides interactive elements
22. Print stylesheet expands accordions
23. Anchor links scroll to correct sections
24. Highlight parameter scrolls to and highlights section

**Coverage Target:**
- Component coverage: 80%+ (educational content with interactive elements)
- Content accuracy: 100% (all calculations must match actual scoring algorithm)

## Change Log

| Date       | Version | Description                          | Author        |
|------------|---------|--------------------------------------|---------------|
| 2025-10-07 | 1.0     | Initial story created from PRD Epic 1 | SM (Winston)  |

## Dev Agent Record

### Agent Model Used
_To be populated by dev agent during implementation_

### Debug Log References
_To be populated by dev agent during implementation_

### Completion Notes
_To be populated by dev agent during implementation_

### File List
_To be populated by dev agent during implementation_

## QA Results

_To be populated by QA agent after implementation review_
