# Story 13.2: RFP Delivery System

## Status
Draft

## Story

**As a** system
**I want** to deliver RFPs to selected vendors via professional email
**So that** vendors receive detailed proposals and can respond effectively

## Acceptance Criteria

1. Email template includes:
   - Company name and brief overview
   - RFP summary and objectives
   - Link to full RFP details (vendor portal)
   - Attached documents (if < 5MB total, else download link)
   - Response instructions and deadline
2. API: `POST /v1/rfp/:id/send` triggers delivery to selected vendors
3. Batch email sending: One email per vendor with personalized greeting
4. Delivery confirmation logged to RFP record (sentAt timestamp)
5. Vendor notification creates VendorContact record with type: `RFP`
6. Error handling: Failed sends logged, user notified of delivery status
7. Email service integration: Reuse existing email.service.ts patterns

## Tasks / Subtasks

### Backend Tasks

- [ ] **Task 1: RFP Email Template** (AC: 1)
  - [ ] Create `backend/src/templates/rfp-delivery.html` HTML email template
  - [ ] Create `backend/src/templates/rfp-delivery.text` plain text version
  - [ ] Template variables: `{{companyName}}`, `{{vendorName}}`, `{{rfpTitle}}`, `{{objectives}}`, `{{requirements}}`, `{{timeline}}`, `{{budget}}`, `{{rfpViewLink}}`, `{{documentsInfo}}`, `{{responseDeadline}}`, `{{contactEmail}}`
  - [ ] Professional layout with company branding placeholder
  - [ ] Mobile-responsive HTML design
  - [ ] Include footer with unsubscribe/contact info

- [ ] **Task 2: Extend Email Service** (AC: 3, 7)
  - [ ] Add method to email.service.ts: `sendRFPToVendor(vendorEmail, vendorName, rfpData, documentUrls)`
  - [ ] Load rfp-delivery template (HTML + text)
  - [ ] Render template with RFP data
  - [ ] Handle documents:
    - If total size < 5MB: Include as attachments
    - Else: Include download links in email body
  - [ ] Use existing sendEmailWithRetry method (3 retries, exponential backoff)
  - [ ] Subject line: "RFP from {{companyName}}: {{rfpTitle}}"

- [ ] **Task 3: Batch Email Sending Logic** (AC: 2, 3, 6)
  - [ ] Extend rfp.service.ts with `sendRFP(rfpId, userId)` method
  - [ ] Fetch RFP by ID with authorization check (owner only)
  - [ ] Validate RFP status = DRAFT (cannot resend sent RFPs)
  - [ ] Fetch all vendors by IDs from RFP.vendorIds
  - [ ] For each vendor:
    - Extract vendor email from Vendor.contactEmail
    - Call email.service.sendRFPToVendor with personalized greeting
    - Create VendorContact record with type: RFP, rfpId link, status: PENDING
    - Log success/failure per vendor
  - [ ] Use Promise.allSettled for parallel sending (don't fail all if one fails)
  - [ ] Return delivery report: { successCount, failedVendors: [vendorId, error][] }

- [ ] **Task 4: Update RFP Status** (AC: 4)
  - [ ] After batch send completes, update RFP:
    - Set status = SENT
    - Set sentAt = new Date()
  - [ ] Update occurs only if at least 1 vendor email succeeded
  - [ ] If all emails fail, throw error (don't mark as SENT)

- [ ] **Task 5: RFP Send API Route** (AC: 2, 6)
  - [ ] Add route to rfp.routes.ts: `POST /v1/rfp/:id/send`
  - [ ] Require authentication + Premium tier
  - [ ] Authorization: User must own the RFP
  - [ ] Call rfp.service.sendRFP(rfpId, userId)
  - [ ] Response:
    ```typescript
    {
      success: true,
      data: {
        rfpId: string,
        vendorsSent: number,
        failedVendors: Array<{ vendorId, companyName, error }>,
        sentAt: DateTime
      },
      message: "RFP sent to 5 vendors successfully (2 failed)"
    }
    ```
  - [ ] Error handling: Return 400 if RFP already sent, 403 if not owner, 500 if all sends failed

- [ ] **Task 6: Document URL Generation** (AC: 1)
  - [ ] Add method to rfp.service.ts: `generateDocumentDownloadLinks(rfpId, documents: string[])`
  - [ ] Generate pre-signed URLs for Replit Object Storage (valid for 7 days)
  - [ ] Return array of: `{ filename, url, size }`
  - [ ] Include in email template data

- [ ] **Task 7: VendorContact Creation** (AC: 5)
  - [ ] In batch send loop, create VendorContact for each vendor:
    - vendorId: Vendor ID
    - userId: RFP owner's user ID
    - organizationId: RFP's organization ID
    - rfpId: RFP ID (link to RFP)
    - type: RFP (ContactType enum)
    - message: RFP objectives summary
    - requirements: JSON with RFP data
    - budget: RFP budget field
    - timeline: RFP timeline field
    - status: PENDING
  - [ ] VendorContact serves as lead tracking record

### Frontend Tasks

- [ ] **Task 8: Send RFP Button** (AC: 2)
  - [ ] Add "Send RFP" button to RFP form (after save as draft)
  - [ ] Button appears only if RFP status = DRAFT
  - [ ] Button disabled if no vendors selected
  - [ ] On click: Show confirmation modal with vendor count
  - [ ] Confirmation modal: "Send RFP to 5 vendors? This action cannot be undone."

- [ ] **Task 9: Send RFP Mutation** (AC: 2, 6)
  - [ ] Create mutation hook: `useSendRFP(rfpId)` using TanStack Query
  - [ ] Call `POST /v1/rfp/:id/send`
  - [ ] On success:
    - Show success toast: "RFP sent to X vendors"
    - If failedVendors.length > 0: Show warning with failed vendor names
    - Update RFP status to SENT in cache
    - Redirect to RFP dashboard
  - [ ] On error:
    - Show error toast with message
    - If RFP already sent (400): Display "RFP has already been sent"

- [ ] **Task 10: Sending Progress UI** (AC: 3, 6)
  - [ ] During send operation, show modal with:
    - Progress spinner
    - "Sending RFP to vendors..." message
    - Vendor count progress: "Sent to 3 / 5 vendors"
  - [ ] After send completes:
    - Show summary: "Successfully sent to 5 vendors"
    - If failures: List failed vendors with reason
    - "Close" button to dismiss

### Testing

- [ ] **Task 11: Email Template Testing**
  - [ ] Test HTML template renders correctly with all variables
  - [ ] Test plain text template (no HTML tags)
  - [ ] Test with different document scenarios: 0 docs, 1 doc, 5 docs, >5MB total
  - [ ] Visual inspection: Mobile responsive, professional appearance

- [ ] **Task 12: Backend Unit Tests** (AC: 3, 4, 5, 7)
  - [ ] Test email.service.sendRFPToVendor: valid data, missing vendor email
  - [ ] Test rfp.service.sendRFP: batch send logic, parallel processing
  - [ ] Test VendorContact creation: correct fields, rfpId link
  - [ ] Test RFP status update: DRAFT â†’ SENT after send
  - [ ] Test failure scenarios: All emails fail (RFP stays DRAFT), some fail (RFP marked SENT)

- [ ] **Task 13: API Contract Tests** (AC: 2, 6)
  - [ ] Test POST /v1/rfp/:id/send as Premium user (200), as Free user (403)
  - [ ] Test send with valid RFP (200), already sent RFP (400), non-owner (403)
  - [ ] Test response includes vendorsSent count, failedVendors array
  - [ ] Test VendorContact records created for all vendors

## Dev Notes

### Project Context
Story 13.2 implements the email delivery system for RFPs created in Story 13.1. Once a user creates an RFP with selected vendors, this story enables sending the RFP via professional email to all selected vendors, creating lead tracking records, and updating RFP status.

**Dependencies:** Story 13.1 (RFP model, creation API) must be complete.

[Source: docs/prd/epic-13-rfp-vendor-engagement.md#Story 13.2]

### Tech Stack
- **Backend**: Fastify 4 + TypeScript 5.2 | Prisma 6 | Postmark (email provider)
- **Frontend**: React 18 + TypeScript | TanStack Query 5
- **Email**: Postmark API (NOT SendGrid/AWS SES)

[Source: CLAUDE.md#Tech Stack, backend/src/services/email.service.ts]

### Email Service Architecture

**Existing Email Service (Postmark Integration):**
- Service: `EmailServiceImpl` in `backend/src/services/email.service.ts`
- Email provider: Postmark (via `postmark` npm package)
- Templates: Stored in `backend/src/templates/` as `.html` and `.text` files
- Template rendering: `{{variable}}` placeholder syntax
- Sending method: `sendEmailWithRetry(to, subject, htmlBody, textBody)` with 3 retries and exponential backoff
- Rate limiting: 5 emails per hour per email address (in-memory Map)
- From email: Configured via `POSTMARK_FROM_EMAIL` and `POSTMARK_FROM_NAME` env vars

**Existing Template Pattern:**
```
backend/src/templates/
  - verification-email.html / .text
  - password-reset-email.html / .text
  - assessment-completion.html / .text
  - account-status-change.html / .text
  - email-change-verification.html / .text
```

**Template Rendering:**
- `loadTemplate(templateName, 'html' | 'text')` loads file from templates directory
- `renderTemplate(template, data)` replaces `{{key}}` with values from data object
- Example: `{{companyName}}` replaced with actual company name

[Source: backend/src/services/email.service.ts:1-180]

### New RFP Email Template

**Template Files to Create:**
- `backend/src/templates/rfp-delivery.html` - HTML version
- `backend/src/templates/rfp-delivery.text` - Plain text version

**Required Variables:**
- `{{companyName}}` - Sender's company name
- `{{vendorName}}` - Recipient vendor's company name
- `{{rfpTitle}}` - RFP title
- `{{objectives}}` - Project objectives
- `{{requirements}}` - Technical requirements summary
- `{{timeline}}` - Project timeline
- `{{budget}}` - Budget range
- `{{rfpViewLink}}` - URL to view full RFP (future: vendor portal)
- `{{documentsInfo}}` - Either "Attached" or list of download links
- `{{responseDeadline}}` - When vendor should respond
- `{{contactEmail}}` - Sender's email for responses

**Email Structure:**
1. Header: Company logo placeholder, "Request for Proposal"
2. Greeting: "Dear {{vendorName}} Team,"
3. Body: RFP summary with objectives, requirements, timeline, budget
4. Documents section: Attachments or download links
5. CTA: "View Full RFP Details" button
6. Footer: Response instructions, contact info, unsubscribe link

[Source: docs/prd/epic-13-rfp-vendor-engagement.md#Story 13.2 AC]

### Email Sending Pattern

**Extending Email Service:**
Add new method to `EmailServiceImpl`:
```typescript
async sendRFPToVendor(
  vendorEmail: string,
  vendorName: string,
  rfpData: {
    companyName: string,
    rfpTitle: string,
    objectives: string,
    requirements: string,
    timeline?: string,
    budget?: string,
    rfpViewLink: string,
    responseDeadline: string,
    contactEmail: string
  },
  documents: { filename: string, url: string, size: number }[]
): Promise<void> {
  // Load templates
  const htmlTemplate = this.loadTemplate('rfp-delivery', 'html');
  const textTemplate = this.loadTemplate('rfp-delivery', 'text');

  // Prepare document info
  const totalSize = documents.reduce((sum, doc) => sum + doc.size, 0);
  const documentsInfo = totalSize < 5 * 1024 * 1024
    ? 'Documents attached to this email'
    : 'Download documents: ' + documents.map(d => `${d.filename}: ${d.url}`).join(', ');

  // Render templates
  const htmlBody = this.renderTemplate(htmlTemplate, {
    ...rfpData,
    vendorName,
    documentsInfo
  });
  const textBody = this.renderTemplate(textTemplate, {
    ...rfpData,
    vendorName,
    documentsInfo
  });

  // Send with retry
  await this.sendEmailWithRetry(
    vendorEmail,
    `RFP from ${rfpData.companyName}: ${rfpData.rfpTitle}`,
    htmlBody,
    textBody
  );
}
```

[Source: backend/src/services/email.service.ts patterns]

### Batch Email Sending Logic

**RFP Service Method:**
In `backend/src/services/rfp.service.ts`, add:
```typescript
async sendRFP(rfpId: string, userId: string): Promise<{
  successCount: number,
  failedVendors: Array<{ vendorId: string, companyName: string, error: string }>
}> {
  // 1. Fetch RFP with authorization
  const rfp = await this.prisma.rFP.findUnique({
    where: { id: rfpId },
    include: { user: true, organization: true }
  });

  if (!rfp) throw this.createError('RFP not found', 404, 'RFP_NOT_FOUND');
  if (rfp.userId !== userId) throw this.createError('Not authorized', 403, 'FORBIDDEN');
  if (rfp.status !== 'DRAFT') throw this.createError('RFP already sent', 400, 'RFP_ALREADY_SENT');

  // 2. Fetch vendors
  const vendors = await this.prisma.vendor.findMany({
    where: { id: { in: rfp.vendorIds } },
    select: { id: true, companyName: true, contactEmail: true }
  });

  // 3. Generate document download links
  const documentLinks = await this.generateDocumentDownloadLinks(rfpId, rfp.documents);

  // 4. Send emails in parallel
  const results = await Promise.allSettled(
    vendors.map(async (vendor) => {
      if (!vendor.contactEmail) {
        throw new Error('No contact email');
      }

      // Send email
      await this.emailService.sendRFPToVendor(
        vendor.contactEmail,
        vendor.companyName,
        {
          companyName: rfp.organization.name,
          rfpTitle: rfp.title,
          objectives: rfp.objectives,
          requirements: rfp.requirements,
          timeline: rfp.timeline,
          budget: rfp.budget,
          rfpViewLink: `${env.FRONTEND_URL}/rfp/${rfpId}`, // Future vendor portal
          responseDeadline: 'Within 14 days',
          contactEmail: rfp.user.email
        },
        documentLinks
      );

      // Create VendorContact record
      await this.prisma.vendorContact.create({
        data: {
          vendorId: vendor.id,
          userId: rfp.userId,
          organizationId: rfp.organizationId,
          rfpId: rfp.id,
          type: 'RFP',
          message: rfp.objectives,
          requirements: { rfpData: rfp },
          budget: rfp.budget,
          timeline: rfp.timeline,
          status: 'PENDING'
        }
      });

      return { vendorId: vendor.id, success: true };
    })
  );

  // 5. Process results
  const failedVendors = results
    .map((result, index) => ({ result, vendor: vendors[index] }))
    .filter(({ result }) => result.status === 'rejected')
    .map(({ result, vendor }) => ({
      vendorId: vendor.id,
      companyName: vendor.companyName,
      error: (result as PromiseRejectedResult).reason.message
    }));

  const successCount = results.filter(r => r.status === 'fulfilled').length;

  // 6. Update RFP status (if at least 1 success)
  if (successCount > 0) {
    await this.prisma.rFP.update({
      where: { id: rfpId },
      data: { status: 'SENT', sentAt: new Date() }
    });
  } else {
    throw this.createError('Failed to send RFP to any vendors', 500, 'RFP_SEND_FAILED');
  }

  return { successCount, failedVendors };
}
```

**Key Points:**
- Use `Promise.allSettled` for parallel sending (don't fail all if one fails)
- Create VendorContact record for each vendor (lead tracking)
- Update RFP status only if at least one email succeeds
- Return detailed failure information for user notification

[Source: Service-oriented architecture pattern from CLAUDE.md#Core Architecture]

### VendorContact Lead Tracking

**VendorContact Record Created Per Vendor:**
- `vendorId`: Vendor receiving the RFP
- `userId`: User who created the RFP
- `organizationId`: Organization sending the RFP
- `rfpId`: Link to the RFP (enables querying all contacts for a specific RFP)
- `type`: RFP (ContactType enum - added in Story 13.1)
- `message`: RFP objectives (summary)
- `requirements`: JSON containing full RFP data
- `budget`: Budget range from RFP
- `timeline`: Timeline from RFP
- `status`: PENDING (vendor hasn't responded yet)

**Purpose:**
- Admin lead tracking (Story 13.3 will query these)
- Vendor response management (future stories)
- Analytics (RFP engagement metrics)

[Source: backend/prisma/schema.prisma:907-938, docs/prd/epic-13-rfp-vendor-engagement.md#Story 13.2 AC 5]

### Document Handling

**Document Size Threshold:**
- If total document size < 5MB: Include as email attachments (Postmark supports attachments)
- If total document size >= 5MB: Include download links in email body

**Download Link Generation:**
For Replit Object Storage, generate pre-signed URLs:
```typescript
async generateDocumentDownloadLinks(
  rfpId: string,
  documents: string[]
): Promise<Array<{ filename: string, url: string, size: number }>> {
  // For each document URL in RFP.documents array:
  // 1. Parse filename from URL
  // 2. Get file size from Object Storage
  // 3. Generate pre-signed URL (valid for 7 days)
  // 4. Return { filename, url, size }

  // Use ObjectStorageService from backend/src/objectStorage
  // Pattern: objectStorageService.getSignedUrl(path, expiresIn)
}
```

[Source: docs/prd/epic-13-rfp-vendor-engagement.md#Story 13.2 AC 1, backend/src/objectStorage patterns]

### RFP Status Transition

**Status Flow:**
- DRAFT â†’ SENT (via sendRFP)
- Cannot resend if status = SENT (validation in sendRFP)
- User can later change SENT â†’ ACTIVE, CLOSED, ARCHIVED (Story 13.4)

**sentAt Timestamp:**
- Set when RFP status changes to SENT
- Used for analytics, sorting, filtering
- Displayed in RFP dashboard (Story 13.4)

[Source: docs/prd/epic-13-rfp-vendor-engagement.md#Database Schema - RFP model]

### API Route Pattern

**Route:** `POST /v1/rfp/:id/send`

**Middleware:**
- Authentication (JWT required)
- Premium tier check (via requirePremiumTier middleware from Story 13.1)

**Authorization:**
- User must own the RFP (userId check)

**Request:**
- No body (rfpId in URL parameter)

**Response:**
```typescript
{
  success: true,
  data: {
    rfpId: string,
    vendorsSent: number,
    failedVendors: Array<{
      vendorId: string,
      companyName: string,
      error: string
    }>,
    sentAt: string // ISO 8601 DateTime
  },
  message: "RFP sent to 5 vendors successfully (2 failed)"
}
```

**Error Responses:**
- 400: RFP already sent (`RFP_ALREADY_SENT`)
- 403: Not authorized (not owner or not Premium tier)
- 404: RFP not found
- 500: All emails failed to send

[Source: CLAUDE.md#API Architecture patterns]

### Frontend Integration

**Send RFP Button Location:**
- RFP form modal: "Save Draft" + "Send RFP" buttons
- RFP dashboard: "Send" button on draft RFPs

**Confirmation Modal:**
Before sending, show confirmation:
- Title: "Send RFP to Vendors?"
- Message: "This RFP will be sent to 5 vendors. You cannot undo this action."
- List of vendor names
- Buttons: "Cancel" | "Send RFP"

**Sending Progress:**
Modal with spinner and progress message:
- "Sending RFP to vendors..."
- "Sent to 3 / 5 vendors" (if progress tracking available)

**Success/Failure Handling:**
After send completes:
- Success toast: "RFP sent to 5 vendors successfully"
- Partial failure: Warning toast: "RFP sent to 3 vendors. Failed: Acme Corp (No email), Beta Inc (Server error)"
- Complete failure: Error toast: "Failed to send RFP to any vendors. Please try again."

[Source: Frontend patterns from CLAUDE.md#Frontend Component Patterns]

### Environment Variables

**Required:**
- `POSTMARK_API_KEY`: Postmark API key for sending emails
- `POSTMARK_FROM_EMAIL`: From email address (e.g., noreply@heliolus.com)
- `POSTMARK_FROM_NAME`: From name (e.g., "Heliolus Platform")
- `FRONTEND_URL`: Frontend URL for RFP view links (e.g., https://app.heliolus.com)

**Note:** These are existing env vars (already configured), no new ones needed.

[Source: backend/src/services/email.service.ts:40-52, backend/src/config/env.validation.ts]

### Error Handling

**Email Send Failures:**
- Individual vendor email failure: Log error, continue with other vendors
- All vendor emails fail: Throw error, don't mark RFP as SENT
- Postmark API errors: Retry 3 times with exponential backoff (already implemented in sendEmailWithRetry)

**VendorContact Creation Failures:**
- If VendorContact.create fails: Log error but don't fail entire send
- Email has already been sent, VendorContact is for tracking only

**Rate Limiting:**
- Email service has built-in rate limiting (5 emails/hour per address)
- RFP batch sends bypass individual address rate limit (sends to different vendor emails)
- Future: Consider rate limiting total RFP sends per user (Story 13.5 or future)

[Source: backend/src/services/email.service.ts:120-180 error handling patterns]

### File Locations

**Backend:**
- Templates: `backend/src/templates/rfp-delivery.html`, `rfp-delivery.text`
- Extend service: `backend/src/services/email.service.ts` (add sendRFPToVendor method)
- Extend service: `backend/src/services/rfp.service.ts` (add sendRFP, generateDocumentDownloadLinks)
- Add route: `backend/src/routes/rfp.routes.ts` (POST /v1/rfp/:id/send)

**Frontend:**
- Send button: Add to existing `frontend/src/components/rfp/RFPFormModal.tsx`
- Mutation hook: `frontend/src/hooks/useSendRFP.ts`
- Confirmation modal: `frontend/src/components/rfp/SendRFPConfirmModal.tsx`
- Progress modal: `frontend/src/components/rfp/SendRFPProgressModal.tsx`

[Source: CLAUDE.md#Project Structure]

### Testing

#### Backend Testing Standards

**Email Template Tests:**
- Test HTML template: Variables rendered, no syntax errors, valid HTML structure
- Test text template: Variables rendered, no HTML tags, readable format
- Test with different data: Missing optional fields, long text, special characters

**Service Tests:**
- File: `backend/tests/services/email.service.test.ts`
  - Test sendRFPToVendor with valid data
  - Test with missing vendor email (should throw error)
  - Test document handling: < 5MB (attachments), >= 5MB (links)
- File: `backend/tests/services/rfp.service.test.ts`
  - Test sendRFP batch logic: All succeed, some fail, all fail
  - Test VendorContact creation for each vendor
  - Test RFP status update: DRAFT â†’ SENT
  - Test authorization: Non-owner cannot send
  - Test validation: Cannot resend already-sent RFP

**Contract Tests:**
- File: `backend/tests/contract/rfp.routes.test.ts`
  - Test POST /v1/rfp/:id/send as Premium user (200)
  - Test as Free user (403)
  - Test send with valid DRAFT RFP (200)
  - Test send with already SENT RFP (400)
  - Test non-owner send (403)
  - Test response format: vendorsSent, failedVendors, sentAt
  - Verify VendorContact records created in database

[Source: CLAUDE.md#Testing patterns]

#### Frontend Testing Standards

**Component Tests:**
- Test send button: Enabled for DRAFT, disabled for SENT
- Test confirmation modal: Displays vendor count, cancel/send buttons
- Test progress modal: Shows spinner, progress message
- Test success handling: Toast shown, RFP status updated, redirects
- Test failure handling: Error toast shown, failed vendors listed

**Integration Tests:**
- Test full send flow: Click send â†’ confirm â†’ API call â†’ success/failure

[Source: CLAUDE.md#Testing patterns]

### Security Considerations

**Authorization:**
- User must own the RFP to send it
- Premium tier required (middleware enforced)

**Email Security:**
- Use Postmark's authenticated sending (prevents spoofing)
- Include unsubscribe link in email footer (GDPR/CAN-SPAM compliance)
- Rate limiting prevents spam (5 emails/hour per address)

**Data Exposure:**
- RFP view link: Future vendor portal (not yet implemented in this story)
- Document download links: Pre-signed URLs with 7-day expiration
- Vendor contact info: Only contactEmail exposed (no other vendor data in email)

[Source: docs/prd/epic-13-rfp-vendor-engagement.md#Technical Considerations - Security]

### Performance Considerations

**Parallel Email Sending:**
- Use `Promise.allSettled` to send all emails concurrently
- Reduces total send time (5 vendors = ~5 seconds vs 25 seconds sequential)

**Error Resilience:**
- If one vendor email fails, others still succeed
- Partial success is acceptable (user notified of failures)

**Database Optimization:**
- VendorContact creation in loop: Consider bulk insert if performance issue (future optimization)
- Single RFP status update at end (not per vendor)

[Source: docs/prd/epic-13-rfp-vendor-engagement.md#Technical Considerations - Performance]

### Testing

#### Backend Testing

**Test Framework:** Vitest
**Test Locations:**
- `backend/tests/services/email.service.test.ts`
- `backend/tests/services/rfp.service.test.ts`
- `backend/tests/contract/rfp.routes.test.ts`

**Key Test Cases:**
- Email template rendering with all variables
- Batch send with Promise.allSettled (test partial failures)
- VendorContact creation for each vendor
- RFP status transition DRAFT â†’ SENT
- Authorization checks (owner only, Premium tier)
- Error scenarios (all sends fail, already sent)

**Run Commands:**
- `npm run test` (from backend/)
- `npm run test:contract` (from backend/)

[Source: CLAUDE.md#Testing]

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-27 | 1.0 | Initial story creation for Epic 13: RFP System | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used
(To be populated by dev agent)

### Debug Log References
(To be populated by dev agent)

### Completion Notes List
(To be populated by dev agent)

### File List
(To be populated by dev agent)

## QA Results
(To be populated by QA agent)
