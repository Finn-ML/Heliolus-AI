# Story 8.1: Create Pricing Page with Tier Comparison

## Status
Draft

## Story
**As a** prospective customer,
**I want** to see clear pricing tiers and features,
**so that** I can choose the right plan for my needs.

## Acceptance Criteria
1. New page component created: `frontend/src/pages/Pricing.tsx`
2. Page displays 3 pricing cards side-by-side:
   - **Freemium**: "Free" with feature list
   - **Premium**: "€599/month" (highlighted) with "or €6,490/year (save 10%)"
   - **Enterprise**: "Custom" with "Contact Sales" CTA
3. Feature list for each tier:
   - Freemium: ✅ Compliance Score, ❌ Gap Analysis (Blurred), ❌ Strategy Matrix (Blurred), ✅ Vendor Browse, ❌ Vendor Matching, 📊 2 Assessments Total, ❌ Reports
   - Premium: ✅ All above unlocked, ✅ Vendor Matching (AI), 📊 2 Assessments Included, ✅ Additional: €299 each, ✅ Downloadable Reports, ✅ Lead Tracking
   - Enterprise: ✅ Everything in Premium, 🚀 Unlimited Assessments, 🎯 Custom Billing, 🤝 Dedicated Support
4. Current plan highlighted with "Current Plan" badge (disabled CTA)
5. Premium card visually highlighted (border, shadow, "Most Popular" badge)
6. "Upgrade Now" button navigates to: `/checkout?plan=premium&cycle=monthly`
7. "Contact Sales" opens email: `mailto:sales@heliolus.com`
8. Page fetches user's current subscription to show appropriate CTAs
9. Responsive design (stacks vertically on mobile)

## Tasks / Subtasks

- [ ] **Task 1: Create Pricing Page Component** (AC: 1)
  - [ ] Create file: `frontend/src/pages/Pricing.tsx`
  - [ ] Add basic page structure:
    ```typescript
    import { useQuery } from '@tanstack/react-query';
    import { useNavigate } from 'react-router-dom';
    import { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from '@/components/ui/card';
    import { Button } from '@/components/ui/button';
    import { Badge } from '@/components/ui/badge';
    import { Check, X, Crown, Mail } from 'lucide-react';
    import { cn } from '@/lib/utils';

    export default function Pricing() {
      const navigate = useNavigate();

      // Fetch current subscription
      const { data: billingInfo } = useQuery({
        queryKey: ['subscription', 'billing-info'],
        queryFn: async () => {
          // Get user ID from token or auth context
          const userId = getCurrentUserId();
          const response = await fetch(`/v1/subscriptions/${userId}/billing-info`, {
            headers: {
              Authorization: `Bearer ${localStorage.getItem('token')}`,
            },
          });
          if (!response.ok) return null;
          return response.json();
        },
        enabled: !!localStorage.getItem('token'),  // Only fetch if logged in
      });

      const currentPlan = billingInfo?.data?.plan || null;

      return (
        <div className="container mx-auto px-4 py-12">
          {/* Page content in next tasks */}
        </div>
      );
    }
    ```

- [ ] **Task 2: Add Page Header** (AC: 9)
  - [ ] Add header section:
    ```typescript
    <div className="text-center mb-12">
      <h1 className="text-4xl font-bold mb-4">Choose Your Plan</h1>
      <p className="text-xl text-muted-foreground max-w-2xl mx-auto">
        Select the perfect plan for your compliance needs. Upgrade or downgrade anytime.
      </p>
    </div>
    ```

- [ ] **Task 3: Create PricingCard Component** (AC: 2, 3, 4, 5)
  - [ ] Add PricingCard interface and component:
    ```typescript
    interface PricingTier {
      name: string;
      price: string;
      priceSubtext?: string;
      description: string;
      features: Array<{ text: string; included: boolean; note?: string }>;
      cta: {
        text: string;
        action: () => void;
        variant?: 'default' | 'outline';
        disabled?: boolean;
      };
      highlighted?: boolean;
      badge?: string;
      currentPlan?: boolean;
    }

    const PricingCard = ({ tier }: { tier: PricingTier }) => (
      <Card className={cn(
        'relative flex flex-col',
        tier.highlighted && 'border-primary border-2 shadow-lg scale-105'
      )}>
        {tier.badge && (
          <div className="absolute -top-4 left-1/2 -translate-x-1/2">
            <Badge className="bg-primary text-primary-foreground px-4 py-1">
              {tier.badge}
            </Badge>
          </div>
        )}

        <CardHeader className="text-center pb-8 pt-8">
          <CardTitle className="text-2xl mb-2">{tier.name}</CardTitle>
          <div className="mt-4">
            <span className="text-4xl font-bold">{tier.price}</span>
            {tier.priceSubtext && (
              <p className="text-sm text-muted-foreground mt-2">
                {tier.priceSubtext}
              </p>
            )}
          </div>
          <CardDescription className="mt-4">{tier.description}</CardDescription>
        </CardHeader>

        <CardContent className="flex-1">
          <ul className="space-y-3">
            {tier.features.map((feature, index) => (
              <li key={index} className="flex items-start gap-3">
                {feature.included ? (
                  <Check className="h-5 w-5 text-primary flex-shrink-0 mt-0.5" />
                ) : (
                  <X className="h-5 w-5 text-muted-foreground flex-shrink-0 mt-0.5" />
                )}
                <span className={cn(
                  'text-sm',
                  !feature.included && 'text-muted-foreground line-through'
                )}>
                  {feature.text}
                  {feature.note && (
                    <span className="text-muted-foreground ml-1">({feature.note})</span>
                  )}
                </span>
              </li>
            ))}
          </ul>
        </CardContent>

        <CardFooter className="pt-6">
          <Button
            className="w-full"
            variant={tier.cta.variant || 'default'}
            onClick={tier.cta.action}
            disabled={tier.cta.disabled || tier.currentPlan}
          >
            {tier.currentPlan ? 'Current Plan' : tier.cta.text}
          </Button>
        </CardFooter>
      </Card>
    );
    ```

- [ ] **Task 4: Define Pricing Tiers Data** (AC: 2, 3)
  - [ ] Add pricing tiers configuration:
    ```typescript
    const pricingTiers: PricingTier[] = [
      {
        name: 'Freemium',
        price: 'Free',
        description: 'Get started with basic compliance assessment',
        features: [
          { text: 'Compliance Score', included: true },
          { text: 'Gap Analysis', included: false, note: 'Blurred' },
          { text: 'Strategy Matrix', included: false, note: 'Blurred' },
          { text: 'Vendor Browse', included: true },
          { text: 'AI Vendor Matching', included: false },
          { text: '2 Assessments Total', included: true },
          { text: 'Downloadable Reports', included: false },
        ],
        cta: {
          text: 'Get Started',
          action: () => navigate('/register'),
          variant: 'outline',
        },
        currentPlan: currentPlan === 'FREE',
      },
      {
        name: 'Premium',
        price: '€599',
        priceSubtext: 'per month, or €6,490/year (save 10%)',
        description: 'Full compliance analysis with AI-powered insights',
        features: [
          { text: 'All Freemium features unlocked', included: true },
          { text: 'Full Gap Analysis', included: true },
          { text: 'Strategy Matrix & Priorities', included: true },
          { text: 'AI Vendor Matching', included: true },
          { text: '2 Assessments per month included', included: true },
          { text: 'Additional assessments: €299 each', included: true },
          { text: 'Downloadable PDF Reports', included: true },
          { text: 'Lead Tracking', included: true },
        ],
        cta: {
          text: 'Upgrade to Premium',
          action: () => navigate('/checkout?plan=premium&cycle=monthly'),
        },
        highlighted: true,
        badge: 'Most Popular',
        currentPlan: currentPlan === 'PREMIUM',
      },
      {
        name: 'Enterprise',
        price: 'Custom',
        description: 'Unlimited assessments with dedicated support',
        features: [
          { text: 'Everything in Premium', included: true },
          { text: 'Unlimited Assessments', included: true },
          { text: 'Custom Billing Arrangements', included: true },
          { text: 'Dedicated Account Manager', included: true },
          { text: 'Priority Support', included: true },
          { text: 'Custom Integrations', included: true },
        ],
        cta: {
          text: 'Contact Sales',
          action: () => window.location.href = 'mailto:sales@heliolus.com',
          variant: 'outline',
        },
        currentPlan: currentPlan === 'ENTERPRISE',
      },
    ];
    ```

- [ ] **Task 5: Render Pricing Cards Grid** (AC: 2, 9)
  - [ ] Add responsive grid:
    ```typescript
    <div className="grid grid-cols-1 md:grid-cols-3 gap-8 max-w-6xl mx-auto">
      {pricingTiers.map((tier) => (
        <PricingCard key={tier.name} tier={tier} />
      ))}
    </div>
    ```

- [ ] **Task 6: Add FAQ Section (Optional Enhancement)**
  - [ ] Add FAQ below pricing cards:
    ```typescript
    <div className="mt-20 max-w-3xl mx-auto">
      <h2 className="text-3xl font-bold text-center mb-8">Frequently Asked Questions</h2>
      <div className="space-y-4">
        {/* FAQ items */}
      </div>
    </div>
    ```

- [ ] **Task 7: Add Route to App Router** (AC: 1)
  - [ ] Open `frontend/src/App.tsx` or router configuration
  - [ ] Add route:
    ```typescript
    <Route path="/pricing" element={<Pricing />} />
    ```

- [ ] **Task 8: Update API Client Helper** (AC: 8)
  - [ ] Add helper function to get current user ID:
    ```typescript
    // In frontend/src/lib/api.ts
    export const getCurrentUserId = (): string | null => {
      const token = localStorage.getItem('token');
      if (!token) return null;

      try {
        // Decode JWT to get user ID
        const payload = JSON.parse(atob(token.split('.')[1]));
        return payload.id || payload.sub;
      } catch {
        return null;
      }
    };
    ```

- [ ] **Task 9: Add Loading and Error States** (AC: 8)
  - [ ] Handle loading state while fetching subscription:
    ```typescript
    const { data: billingInfo, isLoading } = useQuery({ ... });

    if (isLoading) {
      return (
        <div className="container mx-auto px-4 py-12 text-center">
          <p>Loading pricing information...</p>
        </div>
      );
    }
    ```

- [ ] **Task 10: Test Responsive Design** (AC: 9)
  - [ ] Test on mobile (< 768px): Cards stack vertically
  - [ ] Test on tablet (768px - 1024px): 2 columns or 3 columns
  - [ ] Test on desktop (> 1024px): 3 columns side-by-side
  - [ ] Verify "Most Popular" badge positioning
  - [ ] Verify Premium card scale/shadow visible

- [ ] **Task 11: Add Navigation Link** (AC: 6, 7)
  - [ ] Add "Pricing" link to main navigation menu
  - [ ] Add "View Pricing" link from upgrade prompts
  - [ ] Verify navigation from quota warnings works

## Dev Notes

### Pricing Tiers Summary

**Freemium (Free):**
- Compliance score visible
- Gap analysis and strategy matrix blurred
- Can browse vendors (no AI matching)
- 2 assessments total (lifetime limit)
- No downloadable reports

**Premium (€599/month or €6,490/year):**
- All features unlocked
- Full gap analysis and strategy matrix
- AI vendor matching with scores
- 2 assessments per billing cycle
- Additional assessments: €299 each
- PDF reports
- Lead tracking

**Enterprise (Custom Pricing):**
- Everything in Premium
- Unlimited assessments
- Custom billing arrangements
- Dedicated support
- Custom integrations

[Source: docs/prd/epic-8-frontend-integration.md#Story 4.1, docs/V4_REVISED_PAY_GATING_PLAN.md]

---

### Component Structure

**Page Hierarchy:**
```
<Pricing>
  <Header>
    <Title>Choose Your Plan</Title>
    <Subtitle>...</Subtitle>
  </Header>

  <PricingGrid>
    <PricingCard tier={freemium} />
    <PricingCard tier={premium} highlighted />
    <PricingCard tier={enterprise} />
  </PricingGrid>

  <FAQ> (optional)
</Pricing>
```

**PricingCard Structure:**
```
<Card highlighted={isPremium}>
  <Badge>Most Popular</Badge>  // Only on Premium

  <CardHeader>
    <Title>Premium</Title>
    <Price>€599 / month</Price>
    <Subtext>or €6,490/year (save 10%)</Subtext>
    <Description>Full compliance analysis...</Description>
  </CardHeader>

  <CardContent>
    <FeatureList>
      <Feature included>✓ Gap Analysis</Feature>
      <Feature excluded>✗ Custom Integrations</Feature>
    </FeatureList>
  </CardContent>

  <CardFooter>
    <Button>Upgrade to Premium</Button>
    OR
    <Button disabled>Current Plan</Button>
  </CardFooter>
</Card>
```

[Source: frontend/src/components/ui/card.tsx, Radix UI patterns]

---

### Radix UI Components Used

**Available Components:**
- `Card`, `CardHeader`, `CardTitle`, `CardDescription`, `CardContent`, `CardFooter` - Pricing card structure
- `Button` - CTAs
- `Badge` - "Most Popular", "Current Plan" badges
- Icons from `lucide-react`: `Check`, `X`, `Crown`, `Mail`

**Styling Utilities:**
- `cn()` - Conditional className merging (from @/lib/utils)
- TailwindCSS classes for responsive design
- `scale-105` - Highlight Premium card
- `border-primary border-2` - Premium card border
- `shadow-lg` - Premium card shadow

[Source: frontend/src/components/ui/*, lucide-react documentation]

---

### Current Plan Detection

**How It Works:**
1. Page loads, check if user is authenticated (token exists)
2. If authenticated, fetch billing info: `GET /v1/subscriptions/:userId/billing-info`
3. Extract `billingInfo.data.plan` (FREE, PREMIUM, or ENTERPRISE)
4. Pass `currentPlan` to each pricing tier
5. If tier matches current plan:
   - Add "Current Plan" badge
   - Disable CTA button
   - Show "Current Plan" text instead of "Upgrade Now"

**Unauthenticated Users:**
- `billingInfo` will be null/undefined
- All CTAs enabled
- Freemium shows "Get Started" (navigates to /register)
- Premium shows "Upgrade to Premium"
- Enterprise shows "Contact Sales"

[Source: docs/stories/7.6.get-subscription-billing-info.story.md]

---

### Routing and Navigation

**URL Patterns:**
- `/pricing` - Main pricing page
- `/checkout?plan=premium&cycle=monthly` - Checkout with pre-selected plan
- `/checkout?plan=premium&cycle=annual` - Checkout with annual billing
- `mailto:sales@heliolus.com` - Email for Enterprise sales

**Navigation Sources:**
- Main nav menu (header)
- Upgrade prompts from quota warnings
- "Learn More" links from modals
- Footer links

[Source: React Router v6 patterns]

---

### Responsive Design

**Breakpoints:**
- Mobile: `< 768px` (md breakpoint)
- Tablet: `768px - 1024px`
- Desktop: `> 1024px`

**Grid Layout:**
```typescript
className="grid grid-cols-1 md:grid-cols-3 gap-8"
```

**Mobile Behavior:**
- Cards stack vertically (1 column)
- Full width cards
- Premium card scale removed on mobile (avoid overflow)
- Badge positioning adjusted

**Desktop Behavior:**
- 3 cards side-by-side
- Premium card slightly scaled (scale-105)
- Equal height cards (flex layout)

[Source: TailwindCSS responsive design patterns]

---

### Pricing Display

**Monthly Pricing:**
- Freemium: "Free"
- Premium: "€599" + subtext "per month, or €6,490/year (save 10%)"
- Enterprise: "Custom"

**Annual Savings Calculation:**
- Monthly: €599 × 12 = €7,188
- Annual: €6,490
- Savings: €7,188 - €6,490 = €698 (9.71% ≈ 10%)

**Display Pattern:**
```
€599
────
per month

or €6,490/year (save 10%)
```

[Source: docs/prd/epic-8-frontend-integration.md#Story 4.1]

---

### Accessibility

**Requirements:**
- Semantic HTML (`<h1>`, `<ul>`, `<button>`)
- ARIA labels for icons
- Keyboard navigation (tab through cards)
- Focus visible on buttons
- Screen reader friendly feature lists
- Alt text for decorative elements

**Implementation:**
```typescript
<Button aria-label="Upgrade to Premium plan">
  Upgrade to Premium
</Button>

<Badge aria-label="Most popular plan indicator">
  Most Popular
</Badge>

<Check aria-hidden="true" />  // Decorative icon
<span className="sr-only">Included feature</span>
```

[Source: WCAG 2.1 guidelines, Radix UI accessibility]

---

### Testing Checklist

- [ ] Page loads without errors
- [ ] Authenticated users see correct "Current Plan" badge
- [ ] Unauthenticated users see all CTAs enabled
- [ ] "Upgrade Now" navigates to checkout with correct params
- [ ] "Contact Sales" opens email client
- [ ] "Get Started" navigates to registration
- [ ] Premium card visually highlighted
- [ ] Responsive design works on mobile/tablet/desktop
- [ ] Feature lists display correctly (checkmarks, strikethrough)
- [ ] Loading state shown while fetching billing info
- [ ] Error state handled gracefully if API fails

[Source: Frontend testing best practices]

---

### File Locations
- **Page:** `frontend/src/pages/Pricing.tsx`
- **Router:** `frontend/src/App.tsx` (add route)
- **API Helper:** `frontend/src/lib/api.ts` (getCurrentUserId)
- **UI Components:** `frontend/src/components/ui/card.tsx`, `button.tsx`, `badge.tsx`

---

### Dependencies
**Depends On:**
- Story 7.6: GET /v1/subscriptions/:userId/billing-info endpoint
- Existing: Card, Button, Badge UI components
- Existing: React Router, TanStack Query

**Depended On By:**
- Story 8.2: Quota warnings link to this page
- Story 8.3: Upgrade modals link to this page
- Story 8.8: Checkout page receives params from this page

---

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-23 | 1.0 | Initial story creation from Epic 8 | Bob (Scrum Master) |

---

## Dev Agent Record
_This section will be populated by the development agent during implementation_

### Agent Model Used
_TBD_

### Debug Log References
_TBD_

### Completion Notes
_TBD_

### File List
_TBD_

---

## QA Results
_This section will be populated by the QA agent after story completion_
